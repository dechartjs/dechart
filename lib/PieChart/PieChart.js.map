{"version":3,"sources":["PieChart/PieChart.js"],"names":["defaultOptions","height","legendHeight","showLegend","PieChart","chartType","componentId","data","options","arguments","renderProxy","values","length","ns","cssNamespace","width","margin","bottom","left","right","top","pureHeight","pureWidth","radius","Math","min","color","d3","scaleOrdinal","schemeCategory20","$svgRoot","style","g","append","attr","pie","sort","value","d","arc","innerRadius","outerRadius","outerArc","toolTip","$htmlRoot","renderLegend","slice","select","selectAll","enter","insert","i","keys","key","merge","transition","duration","attrTween","_current","interpolate","t","on","event","clientX","clientY","html","floor","exit","remove","text","endAngle","startAngle","ratio","d2","pos","centroid","renderRoot","DechartBase"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\n\nimport DechartBase from '../DechartBase';\n\nconst defaultOptions = {\n  height: 232,\n  legendHeight: 36,\n  showLegend: true,\n};\n\nexport default class PieChart extends DechartBase {\n  constructor({\n    chartType,\n    componentId,\n    data,\n    options,\n  }) {\n    super({\n      ...arguments[0],\n      defaultOptions,\n    });\n\n    this.renderProxy();\n  }\n\n  hasDrawableData() {\n    return (this.data.values || []).length > 0;\n  }\n\n  style() {\n    const ns = this.cssNamespace;\n    return `\n      ${ns} path.slice {\n        stroke: #fff;\n      }\n\n      ${ns} polyline {\n        opacity: .3;\n        stroke: black;\n        stroke-width: 1px;\n        fill: none;\n      }\n\n      ${ns} .labelValue {\n        font-size: 60%;\n        opacity: .5;\n      }\n\n      ${ns} .toolTip {\n        position: absolute;\n        display: none;\n        width: auto;\n        height: auto;\n        background: none repeat scroll 0 0 white;\n        border: 0 none;\n        border-radius: 8px 8px 8px 8px;\n        box-shadow: -3px 3px 15px #888888;\n        color: black;\n        font: 12px sans-serif;\n        padding: 5px;\n        text-align: center;\n      }\n\n      ${ns} text {\n        fill: #ffffff;\n        font: 12px SpoqaHanSans;\n        font-weight: 100;\n      }\n    `;\n  }\n\n  renderRoot() {\n    const { data } = this;\n    const { height, width, legendHeight } = this.options;\n    const margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n    };\n    const pureHeight = height - legendHeight - margin.top - margin.bottom;\n    const pureWidth = width - margin.left - margin.right;\n    const radius = Math.min(width, height) / 2;\n    const color = d3.scaleOrdinal(d3.schemeCategory20);\n\n    this.$svgRoot\n      .style('height', height - legendHeight)\n      .style('width', width);\n\n    const g = this.$svgRoot.append('g')\n      .attr('class', 'g-wrapper')\n      .append('g');\n\n    g.append('g')\n      .attr('class', 'slices');\n    g.append('g')\n      .attr('class', 'labelName');\n    g.append('g')\n      .attr('class', 'labelValue');\n    g.append('g')\n      .attr('class', 'lines');\n\n    g.attr('transform', 'translate(' + pureWidth / 2 + ',' + pureHeight / 2 + ')');\n\n    const pie = d3.pie()\n      .sort(null)\n      .value((d) => d.value);\n\n    const arc = d3.arc()\n      .innerRadius(radius * 0.50)\n      .outerRadius(radius * 0.75);\n\n    const outerArc = d3.arc()\n      .innerRadius(radius * 0.62)\n      .outerRadius(radius * 0.62);\n\n    const toolTip = this.$htmlRoot.append('div')\n      .attr('class', 'toolTip');\n\n    this.options.showLegend && this.renderLegend(data);\n\n    const slice = g.select('.slices')\n      .selectAll('path.slice')\n      .data(pie(data.values));\n\n    slice.enter()\n      .insert('path')\n      .style('fill', (d, i) => {\n        return (data.keys[data.values[i].key]\n          ? data.keys[data.values[i].key].color\n          : color(i));\n      })\n      .style('opacity', 0.9)\n      .attr('class', 'slice')\n      .merge(slice)\n\n      .transition()\n      .duration(1000)\n      .attrTween('d', (d) => {\n        this._current = this._current || d;\n        const interpolate = d3.interpolate(this._current, d);\n        this._current = interpolate(0);\n        return (t) => arc(interpolate(t));\n      });\n\n    g.select('.slices')\n      .selectAll('path.slice')\n      .on('mousemove', (d) => {\n        toolTip.style('left', d3.event.clientX + 10 + 'px');\n        toolTip.style('top', d3.event.clientY - 25 + 'px');\n        toolTip.style('display', 'inline-block');\n        toolTip.style('position', 'fixed');\n        toolTip.html((d.data.key) + '<br>' + (Math.floor(d.data.value * 100) / 100));\n      })\n      .on('mouseout', (d) => toolTip.style('display', 'none'));\n\n    slice.exit()\n      .remove();\n\n    const text = g.select('.labelName')\n      .selectAll('text')\n      .data(pie(data.values), (d) => d.data.key);\n\n    text.enter()\n      .append('text')\n      .attr('style', 'text-anchor: middle;')\n      .attr('dy', '.35em')\n      .text((d) => {\n        if (d.endAngle - d.startAngle >= 0.2) {\n          return `${Math.floor(d.data.ratio)}%`;\n        }\n        return '';\n      })\n      .merge(text)\n\n      .transition()\n      .duration(1000)\n      .attrTween('transform', (d) => {\n        this._current = this._current || d;\n        const interpolate = d3.interpolate(this._current, d);\n        this._current = interpolate(0);\n        return (t) => {\n          const d2 = interpolate(t);\n          const pos = outerArc.centroid(d2);\n          return 'translate(' + pos + ')';\n        };\n      });\n\n    text.exit()\n      .remove();\n  }\n\n  render(data) {\n    this.renderRoot(data);\n  }\n}\n"],"file":"PieChart.js"}